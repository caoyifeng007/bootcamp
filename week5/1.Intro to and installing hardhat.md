Installation:

```sh
npm i -D hardhat
```

Create project

```shell
npx hardhat
```

可以使用shorthand

https://hardhat.org/hardhat-runner/docs/guides/command-line-completion#shorthand-hh-and-autocomplete

```sh
npm install --global hardhat-shorthand
```

1. After doing this running `hh` will be equivalent to running `npx hardhat`. For example, instead of running `npx hardhat compile` you can run `hh compile`.

![](setup project.png)



2. You can create your own tasks in your `hardhat.config.js` file. The Config API will be available in the global environment, with functions for defining tasks. You can also import the API with `require("hardhat/config")` if you prefer to keep things explicit, and take advantage of your editor's autocomplete.

   ```js
   // ts写法就要明确地导入task函数
   import { task } from "hardhat/config";
   
   task("accounts", "Prints the list of accounts", async (taskArgs, hre) => {
     const accounts = await hre.ethers.getSigners();
   
     for (const account of accounts) {
       console.log(account.address);
     }
   });
   ```

3. 此时运行 npx hardhat test会报错 (项目用过pnpm安装时候会出现这个，建议npm安装)

   ![](getsignerserror.png)

   去官方仓库issues中寻找到这个 https://github.com/NomicFoundation/hardhat/issues/836

   链接中给出解决方案 https://www.npmjs.com/package/@nomiclabs/buidler-ethers#typescript-support

   ![](fixgetsignerserror.png)

   ```json
   {
     "compilerOptions": {
       "target": "es2020",
       "module": "commonjs",
       "esModuleInterop": true,
       "forceConsistentCasingInFileNames": true,
       "strict": true,
       "skipLibCheck": true
     },
     // 添加下边这行代码
     "files": ["node_modules/@nomiclabs/buidler-ethers/src/type-extensions.d.ts"]
   }
   ```

4. 使用hardhat的forking功能fork mainnet来模拟真实测试，但不会花费real money

   https://hardhat.org/hardhat-network/docs/guides/forking-other-networks#mainnet-forking

   使用dotenv包将配置写到配置文件中，根目录新建 .env 文件
   
   ```properties
   alchemyKey=https://eth-mainnet.g.alchemy.com/v2/OZWyi8vjgLpp4qAl8BC3EEwBLeway5oP
   ```
   
   ```sh
   npm i -S dotenv
   ```
   
   ```js
   import 'dotenv/config
   
   const config: HardhatUserConfig = {
     solidity: "0.8.9",
     // 添加networks字段
     networks: {
       hardhat: {
         forking: {
           // 这里使用自己的alchemy链接
           url: `${process.env.alchemyKey}`,
           blockNumber: 14390000,
         },
       },
     },
   };
   ```
   
   如果不添加 blockNumber字段，运行时会出现fork starting 的提示，说明此时是在forking
   
   ![](hhtestwithoutblocknumber.png)



5. 使用console.log

   When running your contracts and tests on Hardhat Network you can print logging messages and contract variables calling `console.log()` from your Solidity code. To use it you have to import `hardhat/console.sol` in your contract code.

   https://hardhat.org/tutorial/debugging-with-hardhat-network#solidity--console.log

   ![](solconsolelog.png)

6. 切换主网和其他测试网络 (TODO)

   https://hardhat.org/hardhat-runner/docs/config

   

7. 基础的work flow

   ```solidity
   // SPDX-License-Identifier: UNLICENSED
   pragma solidity ^0.8.9;
   
   // Import this file to use console.log
   import "hardhat/console.sol";
   
   contract Greeter {
       string private greeting;
   
       constructor(string memory _greeting) {
           console.log("Deploying a Greeter with greeting:", _greeting);
           greeting = _greeting;
       }
   
       function greet() public view returns (string memory) {
           return greeting;
       }
   
       function setGreeting(string memory _greeting) public {
           console.log("Changing greeting from '%s' to '%s'", greeting, _greeting);
           greeting = _greeting;
       }
   }
   ```

   ```js
   import { expect } from "chai";
   import { ethers } from "hardhat";
   
   describe("Greeter", function () {
       it.only("Should return the new greeting once it's changed", async function () {
           const Greeter = await ethers.getContractFactory("Greeter");
           const greeter = await Greeter.deploy("Hello, world!");
   
           expect(await greeter.greet()).to.equal("Hello, world!");
   
           const setGreetingTx = await greeter.setGreeting("Hola, mundo!");
   
           // wait until the transaction is mined
           await setGreetingTx.wait();
   
           expect(await greeter.greet()).to.equal("Hola, mundo!");
       });
   });
   ```

   

8. View函数和其他能够改变state的函数的区别

   ```js
           const setGreetingTx = await greeter.setGreeting("Hola, mundo!");
   
           // wait until the transaction is mined
           await setGreetingTx.wait();
   ```

   这里为什么是await两次？可以看Greeter合约，setGreeting是会改变state状态的方法，所以执行setGreeting方法会发送交易，所以需要wait来等待这笔交易被block include.

9. ```js
   it.only("Should return the new greeting once it's changed", async function () {
           const Greeter = await ethers.getContractFactory("Greeter");
           const greeter = await Greeter.deploy("Hello, world!");
           // 查看合约
           console.log(greeter);
   
           expect(await greeter.greet()).to.equal("Hello, world!");
   
           const setGreetingTx = await greeter.setGreeting("你好");
           // 查看交易
           console.log(setGreetingTx);
   
           // wait until the transaction is mined
           await setGreetingTx.wait();
   
           expect(await greeter.greet()).to.equal("你好");
       });
   ```

   ![](contractclg.png)

   ![](transactionclg.png)

   可以看到，交易中的to的地址就是合约的address

10. 需要注意的是从hardhat中导入的ethers，这样可以获得更多操作blockchain的方法

    ```js
    import { ethers } from "hardhat";
    ```

11. 